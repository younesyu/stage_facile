<mat-card *ngIf="internship" class="main-container">
<div *ngIf="canAlter" align="right">
  <button mat-raised-button *ngIf="canValidate && !internship.validated" (click)="validateInternship()">Valider</button>
  &nbsp;&nbsp;&nbsp;&nbsp;
  <a mat-raised-button color="primary" [routerLink]="['../edit', internship.id]">Editer</a>
  &nbsp;&nbsp;&nbsp;&nbsp;
  <a mat-raised-button color="warn" (click)="openDialog()">Supprimer</a>
  <br><br>
</div>
  <mat-card-header>
    <mat-card class="header">
      <mat-card-header>
        <mat-card-title>
          {{ internship.function }}
          <br>
        </mat-card-title>
        <mat-card-subtitle>
          Référence convention : {{ internship.conventionReference }}
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        &nbsp; &nbsp; <img src="../../../assets/user.svg" alt="" width="18" height="18" />
        &nbsp; Effectué par <a [routerLink]="['../../students', internship.user.id]"
          style="color: black; text-decoration: underline;">{{ internship.user.firstName }}
          {{ internship.user.lastName }}</a>
        <br><br>
        &nbsp; &nbsp; <img src="../../../assets/company.svg" alt="" width="18" height="18" />
        &nbsp; {{ internship.company.name }} (<a [routerLink]="['../../company', internship.company.id]">Voir les autres
          stages effectués à {{ internship.company.name }}</a>)
        <br><br>
        &nbsp; &nbsp; <img src="../../../assets/location.svg" alt="" width="18" height="18" />
        &nbsp; {{ internship.location }}
        <br><br>
        &nbsp; &nbsp; <img src="../../../assets/factory.svg" alt="" width="18" height="18" />
        &nbsp; {{ internship.industry.name }}
        <br><br>
        <span *ngIf="internship.experienceLevel">&nbsp; &nbsp;<img src="../../../assets/experience.svg" alt="" width="18" height="18" />
        &nbsp; {{ internship.experienceLevel }}
        <br><br></span>
        &nbsp; &nbsp; <img src="../../../assets/calendar.svg" alt="" width="18" height="18" />
        &nbsp; du {{ internship.beginDate | date:'dd/MM/yyyy' }} au {{ internship.endDate | date:'dd/MM/yyyy' }}
        <br><br>
        &nbsp; &nbsp; <img src="../../../assets/money.svg" alt="" width="22" height="22" />
        &nbsp; <span *ngIf="internship.stipend && internship.stipend > 0; else nonPaid">
          <i> {{ internship.stipend }} € / mois </i>
        </span>
        <ng-template #nonPaid>
          <span>
            <i>Stage non rémunéré</i>
          </span>
        </ng-template>
      </mat-card-content>
    </mat-card>

  </mat-card-header>
  <mat-card-content>
    <hr><br><br>
    <mat-card-title>&nbsp; &nbsp;Description</mat-card-title>
    <mat-card class="description">
      {{ internship.description }}
    </mat-card>
  </mat-card-content>
  <mat-card-content *ngIf="review">
    <hr><br><br>
    <mat-card-title>&nbsp; &nbsp;Avis de {{ internship.user.firstName }} {{ internship.user.lastName }}
      sur ce stage
    </mat-card-title>
    <mat-card class="description">
      {{ review.content }}
      {{ review.teamCommunication }}
      {{ review.subject }}
      {{ review.mentorship }}
      {{ review.upvoters.length }}
      {{ review.downvoters.length }}
      <button mat-raised-button (click)="upvoteReview()">upvote</button>
      <button mat-raised-button (click)="downvoteReview()">downvote</button>
        <br>
          <mat-label class="text-muted">Réponses</mat-label>
        <div *ngFor="let reply of replies; let i = index">
          <br>
          <p>Postée {{ reply.postedOn | date:'dd/MM/yyyy' }} à {{ reply.postedOn | date:'HH:mm' }}</p>
          <br>
          <p>{{ reply.content }}</p>
          <button mat-raised-button color="warn" (click)="deleteReply(i)">Supprimer</button>
        </div>

      <form [formGroup]="replyForm">
        <mat-form-field>
          <mat-label>Ecrire un commentaire...</mat-label>
          <textarea matInput formControlName="content" required></textarea>
        </mat-form-field>
        <div>
          <button mat-raised-button [disabled]="replyForm.invalid" (click)="addComment()">Envoyer</button>
        </div>
      </form>
      
    </mat-card>
  </mat-card-content>
</mat-card>